# Đây là file .github/workflows/main.yml
# Tên của quy trình làm việc
name: Python Docker CI

# 1. KÍCH HOẠT (Trigger):
# Chạy quy trình này khi nào?
on:
  push: # Khi có ai đó "push" code
    branches: [ main, master ] # Lên nhánh "main" hoặc "master"
  pull_request: # Hoặc khi có ai đó tạo "pull request"
    branches: [ main, master ]

# 2. CÔNG VIỆC (Jobs):
jobs:
  # Định nghĩa một công việc tên là "build"
  build:
    # Chạy công việc này trên một máy ảo Ubuntu (Linux) của GitHub
    runs-on: ubuntu-latest

    # 3. CÁC BƯỚC (Steps):
    steps:
      # Bước 1: Lấy code từ GitHub về máy ảo
      - name: Checkout repository
        uses: actions/checkout@v3

      # Bước 2: Thiết lập Docker (để máy ảo hiểu lệnh docker)
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      # Bước 3: Build cái container Docker
      # (Giống hệt lệnh 'docker-compose up --build' nhưng dùng 1 lệnh docker)
      - name: Build the Docker image
        # Nó sẽ đọc 'Dockerfile' và xây dựng hình ảnh
        run: docker build . --file Dockerfile --tag my-image-name:latest

      # (Trong dự án thật, bước 4 sẽ là 'docker push' lên Docker Hub
      # và bước 5 là 'deploy' lên server Cloud, nhưng chúng ta dừng ở đây)